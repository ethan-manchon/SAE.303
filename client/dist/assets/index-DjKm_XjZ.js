(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=a(o);fetch(o.href,l)}})();let $="https://mmi.unilim.fr/~manchon3/SAE3.DWeb-DI.03-Base/api/",c=async function(e){let r={method:"GET"};try{var a=await fetch($+e,r)}catch(o){return console.error("Echec de la requête : "+o),!1}return a.status!=200?(console.error("Erreur de requête : "+a.status),!1):await a.json()},s={};s.fetch=async function(){return await c("orders")};s.fetchTopProduct=async function(){return await c("orders?status=topProduct")};s.fetchMonthly=async function(){return await c("orders?status=monthly")};s.fetchCountries=async function(){return await c("orders?status=countries")};s.fetchCateg=async function(){return await c("orders?status=categ")};let f={};f.fetchById=async function(e){return await c("product?id="+e)};f.fetchStock=async function(){return await c("product?status=stock")};f.fetchAll=async function(){return await c("product")};let b={};b.fetchById=async function(e){return await c("customer?id="+e)};b.fetchAll=async function(){return await c("customer")};let y=function(e,r){let a=e;for(let n in r)a=a.replaceAll(new RegExp("{{"+n+"}}","g"),r[n]);return a};const q=await fetch("./src/ui/orders/template.html"),E=await q.text();let x={};x.render=function(e){let r="";return r+=y(E,e),r};let C={};C.render=function(e){var r=JSC.nest().key("product_name").rollup("total_sales").series(e);JSC.chart("topProduct",{type:"horizontal column",debug:!1,palette:"mutedRainbow",yAxis:{label_text:"Nombre de vente"},defaultPoint:{tooltip:"%name: <b>%value</b> ventes",label_text:"<b>%name</b>"},yAxis:{scale_type:"stacked",scale:{range:{max:150}}},xAxis:{defaultTick_label_text:""},defaultBox_boxVisible:!1,legend_visible:!1,title_label_text:"Produits les plus vendus des 6 derniers mois",series:r})};let w={};w.render=function(e){var r=JSC.nest().key(function(a){let n=new Date(a.month),o=n.toLocaleString("default",{month:"short"}),l=n.getFullYear();return`${o} ${l}`}).rollup("total_sales").series(e);JSC.chart("sales",{palette:"mutedRainbow",defaultBox_boxVisible:!0,legend_visible:!1,debug:!1,title_label_text:"Évolution du chiffre d'affaire sur 6 mois",defaultPoint:{tooltip:"%value €",label_text:"<b>%name</b>"},yAxis:{label_text:"Total des ventes",scale:{type:"linear",range:{min:2}},defaultTick:{label:{text:"%value €"}}},xAxis:{crosshair_enabled:!0},series:r})};const S={};S.render=e=>{document.getElementById("salesbycateg");const r=["#3F51B5","#00BCD4","#FF5722","#8BC34A","#FFC107","#E91E63"];JSC.chart("salesbycateg",{type:"radar area",debug:!1,legend_visible:!0,legend:{template:"%icon %name",position:"inside right",layout:"vertical"},animation_duration:500,title_label:{text:"Répartition des ventes en fonction des catégories (6 derniers mois)"},defaultPoint:{tooltip:"%name: %yValue €"},palette:r,debug:!1,yAxis:{alternateGridFill:"none",defaultTick_label_visible:!1},xAxis_defaultTick:{line_visible:!1,label_width:180},defaultSeries_mouseTracking_enabled:!0,defaultPoint_marker:{type:"circle",outline_width:0},defaultSeries:{opacity:.8,line_visible:!0},series:a(e),toolbar_defaultItem_position:"inside top"});function a(n){const o=[...new Set(n.map(i=>i.month))],l=[...new Set(n.map(i=>i.category))];return o.map(i=>{const g=n.filter(u=>u.month===i),_=l.map(u=>{const d=g.find(m=>m.category===u);return{name:u,y:d?d.total_sales:0}});return{name:i,points:_}})}};let v={};v.render=function(e){var r=JSC.nest().key("product_name").rollup("stock").series(e);r.forEach(function(a){a.points.forEach(function(n){n.y===0&&(n.color="red",n.tooltip="%name <b>(Rupture de stock)</b>")})}),JSC.chart("stock",{type:"column",debug:!1,palette:"mutedRainbow",defaultBox_boxVisible:!1,defaultPoint:{tooltip:"%name: <b>%value</b> en stock"},legend_visible:!1,yAxis:{scale:{range:{max:12},type:"linear",interval:4},innerHeight:.5},title_label_text:"Produits avec le moins de stock",series:r})};const J=await fetch("src/ui/Product/options/template.html"),L=await J.text();let P={};P.render=function(e){let r="";return r+=y(L,e),r};const F=await fetch("./src/ui/Product/template.html"),I=await F.text();let k={};k.render=function(e){let r="";r+=y(I);let a="";for(let n in e)a+=P.render(e[n]);return r=r.replace("{{options}}",a),r};let p={};p.render=function(e){p.chart&&p.chart.destroy();var r=JSC.nest().key("month").rollup("sales_count").series(e);p.chart=JSC.chart("chartproduct",{debug:!0,type:"area",height:200,title_label_text:"Évolution du nombre de vente par mois",legend_visible:!1,defaultSeries:{shape_opacity:.7,color:"#f7315e",defaultPoint_marker:{size:10,outline:{color:"white",width:2}},defaultPoint:{tooltip:function(a){const n=new Date(a.x),o=n.toLocaleString("default",{month:"short"}),l=n.getFullYear();return a.y==1?` ${a.y} vente en ${o} ${l}`:` ${a.y} ventes en ${o} ${l}`}}},yAxis:{crosshair_enabled:!0},xAxis:{scale_type:"time"},series:r})};const O=await fetch("src/ui/Customer/options/template.html"),R=await O.text();let A={};A.render=function(e){let r="";return r+=y(R,e),r};const H=await fetch("./src/ui/Customer/template.html"),D=await H.text();let B={};B.render=function(e){let r="";r+=y(D);let a="";for(let n in e)a+=A.render(e[n]);return r=r.replace("{{options}}",a),r};let h={};h.render=function(e){h.chart&&h.chart.destroy(),JSC.nest().key("category").rollup("quantity").series(e),h.chart=r(a(e));function r(n){return JSC.chart("chartcustomer",{debug:!1,defaultSeries_type:"column",palette:"midTones",height:200,title_label_text:"Achat d'un client par catégorie",defaultAxis_defaultTick_gridLine_visible:!1,defaultPoint:{tooltip:"%name: <b>%value</b> achats",label_text:""},legend_visible:!1,series:n,yAxis:{label_text:"Achats",scale:{range:{max:16},type:"linear",interval:2}},xAxis:{defaultTick_label_text:""}})}function a(n){n.reverse();var o=JSC.getPalette("default"),l=0,i={},g=JSC.nest().key("product_name").pointRollup(function(u,d){var m=d[0].category;return i[m]||(i[m]=o[l%o.length],l++),{x:u,y:d[0].quantity,color:i[m]}}).series(n),_=[{type:"pie donut",shape:{center:"75%, 30%",size:"40%",innerSize:"50%",label:{verticalAlign:"middle",text:"<b>%name</b>"}},defaultPoint:{tooltip:"%name: <b>%value</b>",label_text:"%name {%percentOfSeries:n0}%"},points:JSC.nest().key("category").pointRollup(function(u,d){return{x:u,y:JSC.sum(d,"quantity"),color:i[u]}}).points(n)}];return g.concat(_)}};var T={};T.render=function(e){var r=["#ffcc99","#cc0000"];JSC.chart("countries",{margin:[6,6],box_fill:"white",type:"heatmap solid",overlapBranding:!0,title_label_text:"Tableau des ventes par pays et par mois",palette:{pointValue:function(a){return a.options("z")},colors:r},height:250,legend_visible:!0,defaultAxis_defaultTick:{line_visible:!1,label:{color:"#000",maxWidth:170},placement:"outside"},xAxis_defaultTick_padding:-2,defaultPoint:{outline_width:0,tooltip:"%yValue - %xValue<br><b>%zValue produits expédiés</b>"},series:[{name:"Ventes par pays et par mois",points:e.map(a=>({x:new Date(a.month).toLocaleString("default",{month:"long",year:"numeric"}),y:a.country,z:a.total_quantity}))}]})};let t={header:document.querySelector("#header"),topProduct:document.querySelector("#topProduct"),sales:document.querySelector("#sales"),salesbycateg:document.querySelector("#salesbycateg"),product:document.querySelector("#product"),customer:document.querySelector("#customer"),chartproduct:document.querySelector("#chartproduct"),chartcustomer:document.querySelector("#chartcustomer"),stock:document.querySelector("#stock"),countries:document.querySelector("#countries")},V={};V.init=function(){t.init()};t.init=async function(){t.renderOrders(),t.renderTopProduct(),t.renderSales(),t.renderSaleByCateg(),t.renderStock(),t.renderProduct(),t.renderCustomer(),t.renderCountries()};t.renderOrders=async function(){t.header.innerHTML=x.render(await s.fetch())},t.renderTopProduct=async function(){t.topProduct=C.render(await s.fetchTopProduct())},t.renderSales=async function(){t.sales=w.render(await s.fetchMonthly())},t.renderSaleByCateg=async function(){t.salesbycateg=S.render(await s.fetchCateg())},t.renderStock=async function(){t.stock=v.render(await f.fetchStock())},t.renderProduct=async function(){t.product.innerHTML=k.render(await f.fetchAll()),t.setupProductHandler(),t.renderChartProducts(1),t.clearChartProduct()},t.setupProductHandler=async function(){document.getElementById("productStat").addEventListener("change",async function(){let e=document.getElementById("productStat").value;t.renderChartProducts(e)})},t.clearChartProduct=async function(){t.chartproduct=""},t.renderChartProducts=async function(e){t.clearChartProduct(),t.chartproduct=p.render(await f.fetchById(e))},t.renderCustomer=async function(){t.customer.innerHTML=B.render(await b.fetchAll()),t.setupCustomerHandler(),t.renderChartCustomer(1),t.clearChartCustomer()},t.setupCustomerHandler=async function(){document.getElementById("customerStat").addEventListener("change",async function(){let e=document.getElementById("customerStat").value;t.renderChartCustomer(e)})},t.clearChartCustomer=async function(){t.chartcustomer=""},t.renderChartCustomer=async function(e){t.clearChartCustomer(),t.chartcustomer=h.render(await b.fetchById(e))};t.renderCountries=async function(){t.countries=T.render(await s.fetchCountries())};V.init();
